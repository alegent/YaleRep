
# cd /mnt/data2/scratch/GMTED2010/solar_radiation/nrel/csv
# ls /mnt/data2/scratch/GMTED2010/solar_radiation/nrel/csv/*TY.csv  | xargs -n 1 -P 10 bash /mnt/data2/scratch/GMTED2010/solar_radiation/scripts/sc1_nrel_day_sum.sh

INDIR=/mnt/data2/scratch/GMTED2010/solar_radiation/nrel/csv
file=$1
filename=$(basename $file .csv)

# awk -F "," '{  if(NR>2) {  for (col=1;col<=NF-1;col++) {printf ("%s ", $col )} ; printf ("%s\n", $NF)}}'  $INDIR/${filename}.csv  | sort -k 1,1 -g > $INDIR/${filename}_s.txt

# /mnt/data2/scratch/GMTED2010/solar_radiation/scripts/sum.sh  $INDIR/${filename}_s.txt  $INDIR/${filename}_sum.txt <<EOF
# n
# 1
# 0
# EOF

# cat header.txt > $INDIR/${filename}_sumH.txt
# # inserted to remove the last space after NF
# awk  '{  for (col=1;col<=(NF-1);col++) {printf ("%s ", $col )} ; printf ("%s\n", $NF) }' $INDIR/${filename}_sum.txt >> $INDIR/${filename}_sumH.txt 
# # rm  $INDIR/${filename}_sum.txt $INDIR/${filename}_s.txt


LAT=$(grep ${filename:0:6} $INDIR/TMY3_StationsMeta.csv | awk -F "," '{  print $4  }')
LON=$(grep ${filename:0:6} $INDIR/TMY3_StationsMeta.csv | awk -F "," '{  print $5  }')

# echo $LON $LAT
# check if the poin fall inside the tile 
intile=$(gdallocationinfo -geoloc -wgs84 /mnt/data2/scratch/GMTED2010/grassdb/glob_rad/1/glob_rad_day1_2_1.tif $LON $LAT |tail -1   | awk '{ print $1}')

# echo $intile

if [ $intile = "Location" ] ; then 
    exit
else
    echo extract data from $file
    rm -f /mnt/data2/scratch/GMTED2010/solar_radiation/nrel/txt_grass_rad/${filename:0:6}_rad.txt
    for day in `seq 1 80` ; do 
        echo $day  $(gdallocationinfo -valonly  -geoloc -wgs84 /mnt/data2/scratch/GMTED2010/grassdb/glob_rad/$day/glob_rad_day${day}_2_1.tif $LON $LAT) >> /mnt/data2/scratch/GMTED2010/solar_radiation/nrel/txt_grass_rad/${filename:0:6}_rad.txt
#	gdallocationinfo -valonly  -geoloc -wgs84 /mnt/data2/scratch/GMTED2010/grassdb/diff_rad/$day/diff_rad_day${day}_2_1.tif $LON $LAT
#	gdallocationinfo -valonly  -geoloc -wgs84 /mnt/data2/scratch/GMTED2010/grassdb/beam_rad/$day/beam_rad_day${day}_2_1.tif $LON $LAT
#	gdallocationinfo -valonly  -geoloc -wgs84 /mnt/data2/scratch/GMTED2010/grassdb/refl_rad/$day/refl_rad_day${day}_2_1.tif $LON $LAT
    done  
fi 

