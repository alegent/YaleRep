

export DIR=/gpfs/scratch60/fas/sbsc/ga254/grace0/dataproces/RIVER_NETWORK/output/txt/

cd $DIR

for UNIT in 3753 4000  ; do 
    echo $UNIT $(ls stream${UNIT}_log*_DIM*.txt  | wc -l  )
done 


cat stream3753_log*_DIM*.txt | awk '{ print  $3"_"$4 , $1   }'   | sort -k 1,1 > tmp/UNIT3753.txt
cat stream4000_log*_DIM*.txt | awk '{ print  $3"_"$4 , $1   }'   | sort -k 1,1 > tmp/UNIT4000.txt

for UNIT in 4000   ; do 
    ITER=$(  ls stream${UNIT}_log*_DIM*.txt  | wc -l    )
    if [  $ITER -eq 195   ] ; then 
	cat stream${UNIT}_log*_DIM*.txt | awk '{ print  $3"_"$4 , $1   }'   | sort -k 1,1  > tmp/UNIT$UNIT.txt
	join -1 1 -2 1  tmp/UNIT3753.txt  tmp/UNIT$UNIT.txt  | awk '{ print  $1 , $2+ $3  }'   >  tmp/UNITjoin$UNIT.txt
	mv  tmp/UNITjoin$UNIT.txt  tmp/UNIT3753.txt 
    fi 
done 

sort -g -k 2,2  tmp/UNIT3753.txt  >    tmp/CALIBRATION.txt 

cat stream3753_log*_DIM*.txt | awk '{ print  $3"_"$4 , $1   }'   | sort -k 1,1 > tmp/UNIT3753.txt
cat stream4000_log*_DIM*.txt | awk '{ print  $3"_"$4 , $1   }'   | sort -k 1,1 > tmp/UNIT4000.txt
   

for VAR in _001 _005 _010 _100 _200 _300 _400 _500 _600 _700 _800 _900 _950; do 
grep $VAR   tmp/UNIT3753.txt | awk -v VAR=$VAR '{ gsub( VAR , "")  ;  print     }'  | sort -k 2,2 -g >  tmp/UNIT3753$VAR.txt
done 

for VAR in _001 _005 _010 _100 _200 _300 _400 _500 _600 _700 _800 _900 _950; do 
grep $VAR   tmp/UNIT4000.txt | awk -v VAR=$VAR '{ gsub( VAR , "")  ;  print     }'  | sort -k 2,2 -g >  tmp/UNIT4000$VAR.txt
done 

for VAR in  _001 _005 _010 _100 _200 _300 _400 _500 _600 _700 _800 _900 _950 ; do 
grep $VAR   tmp/CALIBRATION.txt  | awk -v VAR=$VAR '{ gsub( VAR , "")  ;  print     }'  | sort -k 2,2 -g >  tmp/CALIBRATION$VAR.txt
done 
            
gnuplot -persist -e " set yrange [3200000:6000000] ; plot  'UNIT4000_001.txt' ,   'UNIT4000_010.txt' ,  'UNIT4000_100.txt' ,  'UNIT4000_200.txt' ,  'UNIT4000_300.txt' ,  'UNIT4000_400.txt' ,  'UNIT4000_500.txt' ,  'UNIT4000_600.txt' ,  'UNIT4000_700.txt' ,  'UNIT4000_800.txt' ,  'UNIT4000_900.txt' ,  'UNIT4000_950.txt' "
 
gnuplot -persist -e " set yrange [16000000:30000000]   ; plot 'UNIT3753_001.txt' ,   'UNIT3753_010.txt' ,  'UNIT3753_100.txt' ,  'UNIT3753_200.txt' ,  'UNIT3753_300.txt' ,  'UNIT3753_400.txt' ,  'UNIT3753_500.txt' ,  'UNIT3753_600.txt' ,  'UNIT3753_700.txt' ,  'UNIT3753_800.txt' ,  'UNIT3753_900.txt' ,  'UNIT3753_950.txt' "

gnuplot -persist -e " set yrange [20000000:40000000] ; plot 'CALIBRATION_001.txt' ,   'CALIBRATION_010.txt' ,  'CALIBRATION_100.txt' ,  'CALIBRATION_200.txt' ,  'CALIBRATION_300.txt' ,  'CALIBRATION_400.txt' ,  'CALIBRATION_500.txt' ,  'CALIBRATION_600.txt' ,  'CALIBRATION_700.txt' ,  'CALIBRATION_800.txt' ,  'CALIBRATION_900.txt' ,  'CALIBRATION_950.txt' " 


