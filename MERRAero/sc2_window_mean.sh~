
# for MMDD in $(  awk '{ print $1  }'  /lustre0/scratch/ga254/dem_bj/MERRAero/tif_day/MMDD_JD.txt ) ; do qsub -v  MMDD=$MMDD  /lustre0/scratch/ga254/scripts_bj/environmental-layers/terrain/procedures/dem_variables/MERRAero/sc2_yearmean.sh    ; done  

# bash /lustre0/scratch/ga254/scripts_bj/environmental-layers/terrain/procedures/dem_variables/MERRAero/sc2_yearmean.sh  0503  



#PBS -S /bin/bash
#PBS -q fas_normal
#PBS -l walltime=00:15:00
#PBS -l nodes=1:ppn=1
#PBS -V
#PBS -o /lustre0/scratch/ga254/stdout
#PBS -e /lustre0/scratch/ga254/stderr

echo working 

DIRTIF_DAY=/lustre0/scratch/ga254/dem_bj/MERRAero/tif_day
DIRTIF_DAY365=/lustre0/scratch/ga254/dem_bj/MERRAero/tif_day365

# MMDD=$1
MONTH=${MMDD:0:2}
DAY=${MMDD:2:2}

JD=$( grep $MMDD  /lustre0/scratch/ga254/dem_bj/MERRAero/tif_day/MMDD_JD.txt  | awk '{ print $2 }'  ) 



echo sum the quality for $DAYc
rm -f  $OUTDIR/file4vrt_day${DAYc}.txt
for YEAR in  $(seq 2002 2014) ; do 
    for DAY in $(awk -v DAYc=$DAYc -v WIND=$WIND ' { if (  NR >= DAYc + 16 - WIND && NR<= DAYc + 16 + WIND ) print $0  }' /lustre0/scratch/ga254/dem_bj/AE_C6_MYD04_L2/day_list_year_round.txt ) ; do  
	# redirect the sterr to dev/null if the file is missing # to a file if the file is there 
	ls  $INDIR/$YEAR/tif/AOD_550_Dark_Target_Deep_Blue_Combined_QA_Flag_year${YEAR}_day${DAY}.tif  2> /dev/null >>  $OUTDIR/file4vrt_day${DAYc}.txt
    done 
done

pkcomposite   $(cat $OUTDIR/file4vrt_day${DAYc}.txt |  xargs -n 1 echo -i $1 ) -min -1 -max 4 -cr sum -dstnodata -9999  -srcnodata -9999   -srcnodata 0   -ot Int32  -co COMPRESS=LZW -co ZLEVEL=9   -o $OUTDIR/AOD_550_QA_sum_day${DAYc}.tif




echo compute the mean for the month $MONTH day   $DAY 
pkcomposite  -cr mean  $( ls $DIRTIF_DAY/Y*/M$MONTH/mean*$DAY.tif  | xargs -n 1 echo -i )  -o $DIRTIF_DAY365/mean$JD.tif 









