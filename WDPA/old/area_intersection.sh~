
# awk '{ if ( NR > 1 ) print $1 }'  /lustre0/scratch/ga254/dem_bj/GMTED2010/geo_file/tiles-te_noOverlap.txt  | xargs -n 1  -P 10  bash /lustre0/scratch/ga254/scripts_bj/environmental-layers/terrain/procedures/dem_variables/WDPA/area_intersection.sh 


# after compile gdal with the following set 
# ./configure   --with-fgdb=/usr/local/FileGDB_API  --with-geos=yes 

# DIR=/mnt/data2/scratch/WDPA
# apps/ogr2ogr  /mnt/data2/scratch/WDPA/shp_input/WDPA_Jan2014.shp  /mnt/data2/scratch/WDPA/shp_input/WDPA_Jan2014_Public/WDPA_Jan2014.gdb 



export RASTERIZE=/lustre0/scratch/ga254/dem_bj/WDPA/rasterize
export SHP=/lustre0/scratch/ga254/dem_bj/WDPA/shp_input/WDPA_Jan2014.shp

# attribute of the shapefile 

#   IUCN_CAT (String) = Ia               11
#   IUCN_CAT (String) = Ib               12
#   IUCN_CAT (String) = II               2
#   IUCN_CAT (String) = III              3
#   IUCN_CAT (String) = IV               4
#   IUCN_CAT (String) = Not Applicable   20
#   IUCN_CAT (String) = Not Reported     21
#   IUCN_CAT (String) = V                5
#   IUCN_CAT (String) = VI               6

export tile=$1
export geo_string=$( grep $tile /lustre0/scratch/ga254/dem_bj/GMTED2010/geo_file/tiles-te_noOverlap.txt  | awk '{ print $2,$3,$4,$5 }'  ) 

echo  clip the large shp
# rm -f $SHP/shp_clip/WDPA_poly_Jan2014_$tile.*

# ogr2ogr -spat  $geo_string  $SHP/shp_clip/WDPA_poly_Jan2014_$tile.shp   $SHP/WDPA_poly_Jan2014.shp

echo  start the resterize 


# for n in 1 2 3 4 5 6 7 8 9 ; do 
for n in 1 ; do 

if [ $n -eq 1  ] ; then  IUCN_CAT='"Ia"' ;              BURN=11 ; fi 
if [ $n -eq 2  ] ; then  IUCN_CAT='"Ib"' ;              BURN=12 ; fi 
if [ $n -eq 3  ] ; then  IUCN_CAT='"II"' ;              BURN=2  ; fi 
if [ $n -eq 4  ] ; then  IUCN_CAT='"III"';              BURN=3  ; fi 
if [ $n -eq 5  ] ; then  IUCN_CAT='"IV"' ;              BURN=4  ; fi 
if [ $n -eq 6  ] ; then  IUCN_CAT='"Not Applicable"' ;  BURN=20 ; fi 
if [ $n -eq 7  ] ; then  IUCN_CAT='"Not Reported"' ;    BURN=21 ; fi 
if [ $n -eq 8  ] ; then  IUCN_CAT='"V"'  ;              BURN=5  ; fi 
if [ $n -eq 9  ] ; then  IUCN_CAT='"VI"' ;              BURN=6  ; fi 


rm -f $RASTERIZE/${tile}_IUCN${BURN}.tif


var=$(echo \'IUCN_CAT=${IUCN_CAT}\')
echo $var 

gdal_rasterize -ot Byte -a_srs EPSG:4326 -l  WDPA_poly_Jan2014_$tile  -a IUCN_CAT  -where  $var   -burn $BURN   -a_nodata 0  -tr   0.008333333333333 0.008333333333333  -te  $geo_string  -co COMPRESS=LZW -co ZLEVEL=9 $SHP/shp_clip/WDPA_poly_Jan2014_${tile}.shp $RASTERIZE/${tile}_IUCN${BURN}.tif 

done 

exit 





